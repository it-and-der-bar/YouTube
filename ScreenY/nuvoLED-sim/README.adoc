# NuvoLED Simulator

Ein Simulator, um **LEDâ€‘Panels** (NuvoLEDâ€‘Protokoll) ohne echte Hardware zu testen. 
Er rendert eingehende Frames in einem Pygameâ€‘Fenster, unterstÃ¼tzt Panelâ€‘Grids, einfache Gammaâ€‘Korrektur und mehrere Datenformate (Panelâ€‘Chunks / Fullâ€‘Frame).

> Originalbeispiel aus der ZIP:  
> `python sim.py --panels 2x2 --led-gap 1 --mac16-start 0xA00c --mac32-base 0x1A00c --bind-ip 127.0.0.9`

---
## Ausschluss
Die Software kommt wie sie ist, es wird keine GewÃ¤hrleistung, Garantie oder Haftung fÃ¼r SchÃ¤den Ã¼bernommen.
Benutztung auf eigene Gefahr!

## Inhalte
- `sim.py` â€“ Simulator & UDPâ€‘Server
- `README.adoc` â€“ Kurzbeispiel (Original)
- diese `README.md` â€“ AusfÃ¼hrliche Anleitung

## Features
- ğŸ§± Panelâ€‘Grids mit frei wÃ¤hlbarer GrÃ¶ÃŸe (z.â€¯B. 3Ã—2 Module, je 128Ã—128)
- â†”ï¸ Zwei Deâ€‘Interleaveâ€‘Modi: `panel` (modulweise) oder `row` (zeilenweise)
- ğŸ›ï¸ Konfigurierbarer **LEDâ€‘Look** (Gap, Farbe, AuÃŸenrand)
- ğŸ¨ Optionales **Gammaâ€‘/LUTâ€‘Processing**
- ğŸ” **Strictâ€‘Mode** fÃ¼r strenge Paketâ€‘ und ProtokollprÃ¼fung
- ğŸ§ª Debugâ€‘Dumps (Frames/Unknown/Gamma) in ein Verzeichnis

## Voraussetzungen
- Python 3.8+
- AbhÃ¤ngigkeiten:
  ```bash
  pip install pygame pillow numpy
  ```

## Schnellstart
```bash
python sim.py --panels 2x2 --panel 128x128 --bind-ip 0.0.0.0
```
- Ein Fenster **â€NuvoLED Simulatorâ€œ** Ã¶ffnet sich.
- mit nuvoLED Home oder der web-app von screeny kann das Panel bespielt werden.

## CLIâ€‘Optionen
```text
--bind-ip <addr>                 (Default: 0.0.0.0) IP, an die der UDPâ€‘Socket gebunden wird
--panels <WxH>                   (Default: 1x1)     Gridâ€‘GrÃ¶ÃŸe, z.â€¯B. 3x2
--panel <WxH>                    (Default: 128x128) Panelâ€‘AuflÃ¶sung eines Moduls
--raw-order [bgr|rgb]            (Default: bgr)     Byteâ€‘Reihenfolge der Rohdaten
--dump                           (Flag)             Schreibe Debugâ€‘Dumps
--dump-dir <path>                                   Zielordner fÃ¼r Dumps (Default: Temp)
--respect-config-offsets         (Flag)             Panelâ€‘Offsets aus CONFIG statt Gridâ€‘Layout
--no-apply-lut                   (Flag)             Gammaâ€‘LUT **nicht** anwenden
--block-h [16|32]                (Default: 32)      BlockhÃ¶he fÃ¼r RAWâ€‘Chunks
--interleave [panel|row]         (Default: panel)   Deâ€‘Interleaveâ€‘Variante
--panel-gap <int>                (Default: 1)       Sichtbarer Rahmen zwischen Panels (px)
--led-gap <int>                  (Default: 1)       Pixelâ€‘Gap rechts/unten (LEDâ€‘Look; 0=aus)
--led-gap-color <#hex|r,g,b>     (Default: 26,26,26)Farbe fÃ¼r LEDâ€‘Gaps, z.â€¯B. â€#1e1e1eâ€œ
--outer-margin <int>             (Default: 12)      AuÃŸenrand um das Canvas (px)
--order-mode [mac16|nblock|config|grid] (Default: config) Zuordnung/Adressierung
--place-mode [layout|id]         (Default: layout)  Platzierung via CONFIGâ€‘Offsets oder lokal nach IDs
--strict                         (Flag)             Strenger Protokollmodus
--mac32-base <hex>               (Default: 0x10B00000) Highâ€‘16 Bits fÃ¼r mac32
--mac16-start <hex>              (Default: 0x0001)      Startwert fÃ¼r mac16 (Panel #1)
```
**Hinweise zu Eingabeformaten**
- GrÃ¶ÃŸen werden als `Breite x HÃ¶he` angegeben, z.â€¯B. `128x128` oder `3x2`.
- Farben als `#RRGGBB` **oder** `r,g,b` (0â€“255).

## Netzwerk & Protokoll (KurzÃ¼berblick)
- **UDPâ€‘Port:** `2000` (Konstante `UDP_PORT`)
- **Broadcastâ€‘Adresse:** `255.255.255.255`
- **Headerâ€‘Bytes:** `0x24 0x24`
- **Nachrichtentypen** (Auszug):
  - `MSG_REGISTER = 15`
  - `MSG_FRAME = 20`
  - `MSG_FRAME_FINISH = 30`
  - `MSG_SYNC = 100`
  - `MSG_CONFIG = 120`
  - `MSG_REG_REQ = 130`
  - `MSG_STATE = 140`
  - `MSG_GAMMA = 127`

### Frameâ€‘Ãœbertragung
- **Fullâ€‘Frame:** Ein einzelner Puffer in `W*H*3` Bytes (RGB/BGR gemÃ¤ÃŸ `--raw-order`).
- **Panelâ€‘Chunks:** Daten kommen in BlÃ¶cken (`--block-h` 16/32 Zeilen). `--interleave` gibt an, ob modulâ€‘ oder zeilenweise gesendet wird.
- Der Simulator reâ€‘assembliert Chunks, achtet optional streng auf Indizes/LÃ¤ngen (`--strict`) und rendert in Echtzeit.

### Platzierung & Adressierung
- **order-mode `mac16`/`nblock`/`config`/`grid`:** steuert, in welcher Reihenfolge Module adressiert werden.
- **place-mode `layout`:** nutzt Offsets aus CONFIG (empfohlen bei realistischen Layouts).
- **place-mode `id`:** platziert lokal anhand der erkannten Modulâ€‘IDs.

## Beispiele
**2Ã—2â€‘Wand mit LEDâ€‘Look, feste MACâ€‘Basis**
```bash
python sim.py   --panels 2x2 --panel 128x128   --led-gap 1 --led-gap-color "#1e1e1e"   --mac16-start 0xA00c --mac32-base 0x1A00c   --bind-ip 127.0.0.9
```

**3Ã—1â€‘Leiste, RAW in RGB gesendet, strenger Modus**
```bash
python sim.py --panels 3x1 --raw-order rgb --strict
```

**Dumps aktivieren und in Ordner schreiben**
```bash
python sim.py --dump --dump-dir ./dumps
```

## Lizenz
Der Code darf nicht kommerziell weiterverwendet werden
PolyForm Noncommercial
â€”

**Viel SpaÃŸ beim Simulieren!**
